box: algas/wercker-mybox

build:
  services:
    - id: mariadb
      username: $USERNAME
      password: $PASSWORD
      tag: latest
      env:
        MYSQL_ROOT_PASSWORD: mypassword

  steps:
    - script:
        name: env
        code: env
    - script:
        name: "Wait for MariaDB connection"
        code: sleep 10
    - script:
        name: migrate database
        code: |
          ./scripts/migrate.sh

dummy:
  steps:
    - script:
        name: dummy
        code: |
          echo 'hello'

migrate:
  steps:
    - pip-install
    - script:
        name: migrate database
        code: |
          ./scripts/migrate.sh

dev:
  services:
    - id: mariadb
      username: $USERNAME
      password: $PASSWORD
      tag: latest
      env:
        MYSQL_ROOT_PASSWORD: mypassword

  steps:
    - script:
        name: env
        code: env
    - script:
        name: "Wait for MariaDB connection"
        code: sleep 20s
    - script:
        name: migrate database
        code: |
          ./scripts/migrate.sh
