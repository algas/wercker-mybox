box: algas/wercker-mybox

services:
  -id: mariadb
  env:
    MYSQL_ROOT_PASSWORD: secret

build:
  steps:
    - script:
        name: env
        code: env
    - script:
        name: "Wait for MariaDB connection"
        code: |
          while ! nc -q 1 $MARIADB_PORT_3306_TCP_ADDR $MARIADB_PORT_3306_TCP_PORT
          </dev/null; do sleep 3; done
    - script:
        name: migrate database
        code: |
          ./scripts/migrate.sh

dummy:
  steps:
    - script:
        name: dummy
        code: |
          echo 'hello'

migrate:
  steps:
    - pip-install
    - script:
        name: migrate database
        code: |
          ./scripts/migrate.sh

dev:
  steps:
    - script:
        name: migrate database
        code: |
          ./scripts/migrate.sh
    - internal/watch:
        code: python app.py
        reload: true
